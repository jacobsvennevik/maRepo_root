{"version":3,"sources":["/Users/jacobhornsvennevik/Documents/GitHub/maRepo_root/frontend/src/features/projects/components/steps/course-content-upload-step.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useCallback, useEffect } from 'react';\nimport { FileUpload } from '@/components/ui/file-upload';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { \n  MOCK_COURSE_CONTENT_PROCESSED_DOCUMENT,\n  simulateProcessingDelay,\n  isTestMode,\n  type ProcessedDocument \n} from '../../services/mock-data';\nimport { hybridUploadAndProcess, enhancedMockUpload } from '../../services/hybrid-test-utils';\nimport { TestModeBanner, ErrorMessage } from '../shared/upload-ui';\nimport { CourseContentMockBanner } from '../shared/mock-mode-banner';\nimport { HybridTestBanner } from '../shared/hybrid-test-banner';\n\ninterface CourseContentUploadStepProps {\n  onUploadComplete: (data: ProcessedDocument[], fileNames: string[], files?: File[]) => void;\n  onAnalysisComplete?: (data: ProcessedDocument[]) => void;\n}\n\nexport function CourseContentUploadStep({\n  onUploadComplete,\n  onAnalysisComplete\n}: CourseContentUploadStepProps) {\n  const [files, setFiles] = useState<File[]>([]);\n  const [uploadProgress, setUploadProgress] = useState<Record<string, number>>({});\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [showSuccess, setShowSuccess] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [storedResults, setStoredResults] = useState<{\n    data: ProcessedDocument[];\n    fileNames: string[];\n  } | null>(null);\n\n  const handleFileUpload = useCallback(async (uploadedFiles: File[]) => {\n    setFiles(uploadedFiles);\n    setError(null);\n    setShowSuccess(false);\n    \n    // Auto-analyze files when they're uploaded\n    await handleAnalyze(uploadedFiles);\n  }, []);\n\n  const handleAnalyze = useCallback(async (filesToAnalyze: File[] = files) => {\n    if (filesToAnalyze.length === 0) return;\n\n    setIsAnalyzing(true);\n    setError(null);\n    setShowSuccess(false);\n\n    try {\n      const firstFile = filesToAnalyze[0];\n      console.log('ðŸ§ª HYBRID MODE: Processing', filesToAnalyze.length, 'course content files through real backend with mock data');\n\n      // TEST MODE: Use enhanced mock with proper state updates\n      if (isTestMode()) {\n        console.log('ðŸ§ª TEST MODE: Analyzing', filesToAnalyze.length, 'course content files with enhanced mock data');\n        \n        // Simulate upload progress for all files\n        for (const file of filesToAnalyze) {\n          setUploadProgress(prev => ({ ...prev, [file.name]: 100 }));\n        }\n        \n        // Use enhanced mock function that properly updates state\n        const results = await enhancedMockUpload(\n          filesToAnalyze,\n          'course_content',\n          (progress) => {\n            console.log('ðŸ§ª ENHANCED MOCK: Progress:', progress);\n          },\n          (uploadedFiles, processedData) => {\n            // ðŸ”§ CRITICAL FIX: Update parent state with files and data\n            console.log('ðŸ§ª ENHANCED MOCK: Updating parent state with files:', uploadedFiles.length, 'data:', processedData.length);\n            \n            // Call onUploadComplete with files to update parent state\n            onUploadComplete(\n              processedData.map(result => ({\n                id: result.id,\n                original_text: result.original_text,\n                metadata: result.processed_data || result.metadata,\n                status: result.status\n              })),\n              uploadedFiles.map(f => f.name),\n              uploadedFiles // ðŸ”§ Pass the actual files to update parent state\n            );\n          }\n        );\n\n        const fileName = firstFile.name;\n        console.log('ðŸ§ª TEST MODE: Course content extraction completed for:', fileName);\n        console.log('ðŸ§ª TEST MODE: Using enhanced mock course content data');\n\n        setIsAnalyzing(false);\n        setShowSuccess(true);\n        setStoredResults({\n          data: results.map(result => ({\n            id: result.id,\n            original_text: result.original_text,\n            metadata: result.processed_data || result.metadata,\n            status: result.status\n          })),\n          fileNames: filesToAnalyze.map(f => f.name)\n        });\n\n        // Call analysis complete callback\n        if (onAnalysisComplete) {\n          onAnalysisComplete(results.map(result => ({\n            id: result.id,\n            original_text: result.original_text,\n            metadata: result.processed_data || result.metadata,\n            status: result.status\n          })));\n        }\n\n        return;\n      }\n\n      // PRODUCTION MODE: Use real backend processing\n      console.log('ðŸš€ PRODUCTION MODE: Processing course content files through real backend');\n      \n      const results = await hybridUploadAndProcess(\n        filesToAnalyze,\n        'course_content',\n        (progress) => {\n          console.log('ðŸš€ PRODUCTION: Progress:', progress);\n        },\n        (uploadedFiles, processedData) => {\n          // Update parent state with files and data\n          onUploadComplete(\n            processedData.map(result => ({\n              id: result.id,\n              original_text: result.original_text,\n              metadata: result.processed_data || result.metadata,\n              status: result.status\n            })),\n            uploadedFiles.map(f => f.name),\n            uploadedFiles\n          );\n        }\n      );\n\n      const fileName = firstFile.name;\n      console.log('ðŸš€ PRODUCTION MODE: Course content extraction completed for:', fileName);\n\n      setIsAnalyzing(false);\n      setShowSuccess(true);\n      setStoredResults({\n        data: results.map(result => ({\n          id: result.id,\n          original_text: result.original_text,\n          metadata: result.processed_data || result.metadata,\n          status: result.status\n        })),\n        fileNames: filesToAnalyze.map(f => f.name)\n      });\n\n      // Call analysis complete callback\n      if (onAnalysisComplete) {\n        onAnalysisComplete(results.map(result => ({\n          id: result.id,\n          original_text: result.original_text,\n          metadata: result.processed_data || result.metadata,\n          status: result.status\n        })));\n      }\n\n    } catch (err) {\n      console.error('Error analyzing course content files:', err);\n      setError(err instanceof Error ? err.message : 'Failed to analyze files');\n      setIsAnalyzing(false);\n    }\n  }, [files, onUploadComplete, onAnalysisComplete]);\n\n  const handleRemoveFile = useCallback((fileName: string) => {\n    setFiles(prev => prev.filter(file => file.name !== fileName));\n    setUploadProgress(prev => {\n      const newProgress = { ...prev };\n      delete newProgress[fileName];\n      return newProgress;\n    });\n    setShowSuccess(false);\n    setStoredResults(null);\n  }, []);\n\n  // Auto-analyze when files change\n  useEffect(() => {\n    if (files.length > 0 && !isAnalyzing && !showSuccess) {\n      handleAnalyze();\n    }\n  }, [files, isAnalyzing, showSuccess, handleAnalyze]);\n\n  // Call onUploadComplete when stored results are available\n  useEffect(() => {\n    if (storedResults && files.length > 0) {\n      onUploadComplete(\n        storedResults.data,\n        storedResults.fileNames,\n        files // ðŸ”§ Pass the actual files to update parent state\n      );\n    }\n  }, [storedResults, files, onUploadComplete]);\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"course-content-upload-step\">\n      {isTestMode() ? (\n        <HybridTestBanner \n          title=\"Course Content Analysis\"\n          description=\"Upload your course materials to see how the real AI processing pipeline works with reliable test data\"\n        />\n      ) : (\n        <CourseContentMockBanner />\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            ðŸ“š Course Content Upload\n            {isTestMode() && <Badge variant=\"secondary\">Test Mode</Badge>}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <FileUpload\n            onUpload={handleFileUpload}\n            accept=\".pdf,.doc,.docx,.ppt,.pptx\"\n            maxSize={25 * 1024 * 1024} // 25MB\n            data-testid=\"file-input\"\n          />\n\n          {files.length > 0 && (\n            <div className=\"space-y-2\">\n              <h4 className=\"font-medium\">Uploaded Files:</h4>\n              {files.map((file) => (\n                <div key={file.name} className=\"flex items-center justify-between p-2 bg-gray-50 rounded\">\n                  <span className=\"text-sm\">{file.name}</span>\n                  <div className=\"flex items-center gap-2\">\n                    {uploadProgress[file.name] !== undefined && (\n                      <Progress value={uploadProgress[file.name]} className=\"w-20\" />\n                    )}\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleRemoveFile(file.name)}\n                      disabled={isAnalyzing}\n                    >\n                      Remove\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n\n          {isAnalyzing && (\n            <div className=\"text-center py-4\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\n              <p className=\"text-sm text-gray-600\">\n                {isTestMode() ? 'ðŸ§ª Simulating AI analysis...' : 'ðŸ¤– Analyzing course content...'}\n              </p>\n            </div>\n          )}\n\n          {showSuccess && (\n            <div className=\"text-center py-4\">\n              <div className=\"text-green-600 text-2xl mb-2\">âœ…</div>\n              <p className=\"text-sm text-green-600 font-medium\">\n                Course content analysis completed successfully!\n              </p>\n              <p className=\"text-xs text-gray-500 mt-1\">\n                {storedResults?.fileNames.length} file(s) processed\n              </p>\n            </div>\n          )}\n\n          {error && <ErrorMessage message={error} />}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"],"names":["CourseContentUploadStep","onUploadComplete","onAnalysisComplete","files","setFiles","useState","uploadProgress","setUploadProgress","isAnalyzing","setIsAnalyzing","showSuccess","setShowSuccess","error","setError","storedResults","setStoredResults","handleFileUpload","useCallback","uploadedFiles","handleAnalyze","filesToAnalyze","length","firstFile","console","log","isTestMode","file","prev","name","results","enhancedMockUpload","progress","processedData","map","result","id","original_text","metadata","processed_data","status","f","fileName","data","fileNames","hybridUploadAndProcess","err","Error","message","handleRemoveFile","filter","newProgress","useEffect","div","className","data-testid","HybridTestBanner","title","description","CourseContentMockBanner","Card","CardHeader","CardTitle","Badge","variant","CardContent","FileUpload","onUpload","accept","maxSize","h4","span","undefined","Progress","value","Button","size","onClick","disabled","p","ErrorMessage"],"mappings":"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"}