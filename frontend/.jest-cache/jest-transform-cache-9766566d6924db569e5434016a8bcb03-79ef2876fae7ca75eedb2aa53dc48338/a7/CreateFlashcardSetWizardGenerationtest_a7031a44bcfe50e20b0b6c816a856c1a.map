{"version":3,"sources":["/Users/jacobhornsvennevik/Documents/GitHub/maRepo_root/frontend/src/features/diagnostics/components/__tests__/CreateFlashcardSetWizard-Generation.test.tsx"],"sourcesContent":["import { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport React from 'react'\nimport CreateFlashcardSetWizard from '../CreateFlashcardSetWizard'\nimport { axiosGeneration, axiosApi } from '@/lib/axios'\n\njest.mock('@/lib/axios', () => ({\n  axiosGeneration: { post: jest.fn() },\n  axiosApi: { get: jest.fn(), post: jest.fn(), patch: jest.fn() },\n}))\n\ndescribe('CreateFlashcardSetWizard - Generation', () => {\n  const projectId = '11111111-1111-1111-1111-111111111111'\n\n  function setup(open = true) {\n    const onOpenChange = jest.fn()\n    render(\n      <CreateFlashcardSetWizard\n        projectId={projectId}\n        open={open}\n        onOpenChange={onOpenChange}\n      />\n    )\n    return { onOpenChange }\n  }\n\n  beforeEach(() => {\n    jest.resetAllMocks()\n    process.env.NODE_ENV = 'test'\n  })\n\n  it('posts to generation endpoint with X-Test-Mode header in test mode', async () => {\n    ;(axiosGeneration.post as jest.Mock).mockResolvedValue({ data: { deck: { suggested_title: 'Deck', suggested_description: 'Desc' }, cards: [] } })\n\n    setup(true)\n\n    // Step 1: choose files\n    await waitFor(() => screen.getByText('How would you like to start?'))\n    fireEvent.click(screen.getByText('Use Files'))\n\n    // Step 2 → Next\n    await waitFor(() => screen.getByText('Upload New Files'))\n    fireEvent.click(screen.getByText('Next'))\n\n    // Step 3: click generate\n    await waitFor(() => screen.getByText('Generate Flashcards'))\n    fireEvent.click(screen.getByText('Generate Flashcards'))\n\n    await waitFor(() => {\n      expect(axiosGeneration.post).toHaveBeenCalledWith(\n        `/projects/${projectId}/flashcards/generate`,\n        expect.objectContaining({ project_id: projectId, source_type: 'files' }),\n        expect.objectContaining({ headers: expect.objectContaining({ 'X-Test-Mode': 'true' }) })\n      )\n    })\n  })\n\n  it('handles generation errors gracefully', async () => {\n    ;(axiosGeneration.post as jest.Mock).mockRejectedValue(new Error('boom'))\n\n    setup(true)\n\n    // Step 1: choose files\n    await waitFor(() => screen.getByText('How would you like to start?'))\n    fireEvent.click(screen.getByText('Use Files'))\n\n    // Step 2 → Next\n    await waitFor(() => screen.getByText('Upload New Files'))\n    fireEvent.click(screen.getByText('Next'))\n\n    // Step 3: click generate\n    await waitFor(() => screen.getByText('Generate Flashcards'))\n    fireEvent.click(screen.getByText('Generate Flashcards'))\n\n    // No throw; just ensure button returns to enabled state eventually\n    await waitFor(() => expect(screen.getByText('Generate Flashcards')).toBeEnabled())\n  })\n})\n"],"names":["jest","mock","axiosGeneration","post","fn","axiosApi","get","patch","describe","projectId","setup","open","onOpenChange","render","CreateFlashcardSetWizard","beforeEach","resetAllMocks","process","env","NODE_ENV","it","mockResolvedValue","data","deck","suggested_title","suggested_description","cards","waitFor","screen","getByText","fireEvent","click","expect","toHaveBeenCalledWith","objectContaining","project_id","source_type","headers","mockRejectedValue","Error","toBeEnabled"],"mappings":";AAKAA,KAAKC,IAAI,CAAC,eAAe,IAAO,CAAA;QAC9BC,iBAAiB;YAAEC,MAAMH,KAAKI,EAAE;QAAG;QACnCC,UAAU;YAAEC,KAAKN,KAAKI,EAAE;YAAID,MAAMH,KAAKI,EAAE;YAAIG,OAAOP,KAAKI,EAAE;QAAG;IAChE,CAAA;;;;;uBARmD;+DACjC;iFACmB;uBACK;;;;;;AAO1CI,SAAS,yCAAyC;IAChD,MAAMC,YAAY;IAElB,SAASC,MAAMC,OAAO,IAAI;QACxB,MAAMC,eAAeZ,KAAKI,EAAE;QAC5BS,IAAAA,aAAM,gBACJ,qBAACC,iCAAwB;YACvBL,WAAWA;YACXE,MAAMA;YACNC,cAAcA;;QAGlB,OAAO;YAAEA;QAAa;IACxB;IAEAG,WAAW;QACTf,KAAKgB,aAAa;QAClBC,QAAQC,GAAG,CAACC,QAAQ,GAAG;IACzB;IAEAC,GAAG,qEAAqE;;QACpElB,sBAAe,CAACC,IAAI,CAAekB,iBAAiB,CAAC;YAAEC,MAAM;gBAAEC,MAAM;oBAAEC,iBAAiB;oBAAQC,uBAAuB;gBAAO;gBAAGC,OAAO,EAAE;YAAC;QAAE;QAE/IhB,MAAM;QAEN,uBAAuB;QACvB,MAAMiB,IAAAA,cAAO,EAAC,IAAMC,aAAM,CAACC,SAAS,CAAC;QACrCC,gBAAS,CAACC,KAAK,CAACH,aAAM,CAACC,SAAS,CAAC;QAEjC,gBAAgB;QAChB,MAAMF,IAAAA,cAAO,EAAC,IAAMC,aAAM,CAACC,SAAS,CAAC;QACrCC,gBAAS,CAACC,KAAK,CAACH,aAAM,CAACC,SAAS,CAAC;QAEjC,yBAAyB;QACzB,MAAMF,IAAAA,cAAO,EAAC,IAAMC,aAAM,CAACC,SAAS,CAAC;QACrCC,gBAAS,CAACC,KAAK,CAACH,aAAM,CAACC,SAAS,CAAC;QAEjC,MAAMF,IAAAA,cAAO,EAAC;YACZK,OAAO9B,sBAAe,CAACC,IAAI,EAAE8B,oBAAoB,CAC/C,CAAC,UAAU,EAAExB,UAAU,oBAAoB,CAAC,EAC5CuB,OAAOE,gBAAgB,CAAC;gBAAEC,YAAY1B;gBAAW2B,aAAa;YAAQ,IACtEJ,OAAOE,gBAAgB,CAAC;gBAAEG,SAASL,OAAOE,gBAAgB,CAAC;oBAAE,eAAe;gBAAO;YAAG;QAE1F;IACF;IAEAd,GAAG,wCAAwC;;QACvClB,sBAAe,CAACC,IAAI,CAAemC,iBAAiB,CAAC,IAAIC,MAAM;QAEjE7B,MAAM;QAEN,uBAAuB;QACvB,MAAMiB,IAAAA,cAAO,EAAC,IAAMC,aAAM,CAACC,SAAS,CAAC;QACrCC,gBAAS,CAACC,KAAK,CAACH,aAAM,CAACC,SAAS,CAAC;QAEjC,gBAAgB;QAChB,MAAMF,IAAAA,cAAO,EAAC,IAAMC,aAAM,CAACC,SAAS,CAAC;QACrCC,gBAAS,CAACC,KAAK,CAACH,aAAM,CAACC,SAAS,CAAC;QAEjC,yBAAyB;QACzB,MAAMF,IAAAA,cAAO,EAAC,IAAMC,aAAM,CAACC,SAAS,CAAC;QACrCC,gBAAS,CAACC,KAAK,CAACH,aAAM,CAACC,SAAS,CAAC;QAEjC,mEAAmE;QACnE,MAAMF,IAAAA,cAAO,EAAC,IAAMK,OAAOJ,aAAM,CAACC,SAAS,CAAC,wBAAwBW,WAAW;IACjF;AACF"}