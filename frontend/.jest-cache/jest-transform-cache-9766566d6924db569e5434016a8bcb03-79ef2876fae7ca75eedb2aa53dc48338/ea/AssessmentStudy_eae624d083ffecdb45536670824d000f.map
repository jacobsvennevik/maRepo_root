{"version":3,"sources":["/Users/jacobhornsvennevik/Documents/GitHub/maRepo_root/frontend/src/features/diagnostics/components/AssessmentStudy.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { \n  RotateCcw, \n  Play,\n  Pause,\n  RotateCw,\n  SkipForward,\n  BarChart3,\n  Settings,\n  Clock\n} from 'lucide-react';\nimport { AssessmentItem, AssessmentSet } from '@/features/diagnostics/types/assessment';\nimport { AssessmentApi } from '@/lib/assessmentApi';\nimport { AssessmentItemRenderer } from './AssessmentItemRenderer';\n\ninterface AssessmentStudyProps {\n  projectId: string;\n  setId: string;\n}\n\ninterface StudySession {\n  id: string;\n  startTime: Date;\n  itemsReviewed: number;\n  correctAnswers: number;\n  totalTime: number;\n  currentStreak: number;\n}\n\nexport default function AssessmentStudy({ projectId, setId }: AssessmentStudyProps) {\n  const [assessmentSet, setAssessmentSet] = useState<AssessmentSet | null>(null);\n  const [currentItem, setCurrentItem] = useState<AssessmentItem | null>(null);\n  const [items, setItems] = useState<AssessmentItem[]>([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [isFlipped, setIsFlipped] = useState(false);\n  const [showHint, setShowHint] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [session, setSession] = useState<StudySession | null>(null);\n  const [isPaused, setIsPaused] = useState(false);\n  const [showReviewDialog, setShowReviewDialog] = useState(false);\n  const [reviewNotes, setReviewNotes] = useState('');\n  const [responseTime, setResponseTime] = useState<number>(0);\n  const [startTime, setStartTime] = useState<Date | null>(null);\n\n  useEffect(() => {\n    (async () => {\n      const set = await AssessmentApi.getAssessmentSet(setId);\n      if (set) setAssessmentSet(set);\n      const items = await AssessmentApi.getAssessmentItems(setId);\n      setItems(items);\n      if (items && items.length > 0) setCurrentItem(items[0]);\n    })();\n    initializeSession();\n  }, [setId]);\n\n  useEffect(() => {\n    if (currentItem && !startTime) {\n      setStartTime(new Date());\n    }\n  }, [currentItem]);\n\n  const initializeSession = () => {\n    const newSession: StudySession = {\n      id: Date.now().toString(),\n      startTime: new Date(),\n      itemsReviewed: 0,\n      correctAnswers: 0,\n      totalTime: 0,\n      currentStreak: 0,\n    };\n    setSession(newSession);\n  };\n\n  const handleItemReview = async (review: any) => {\n    if (!currentItem || !session) return;\n\n    const endTime = new Date();\n    const timeSpent = startTime ? (endTime.getTime() - startTime.getTime()) / 1000 : 0;\n    setResponseTime(timeSpent);\n\n    // Update session\n    const updatedSession = {\n      ...session,\n      itemsReviewed: session.itemsReviewed + 1,\n      correctAnswers: session.correctAnswers + (review.is_correct || review.quality >= 3 ? 1 : 0),\n      currentStreak: review.is_correct || review.quality >= 3 ? session.currentStreak + 1 : 0,\n    };\n    setSession(updatedSession);\n\n    // Submit review to backend\n    try {\n      await AssessmentApi.reviewAssessmentItem(currentItem.id, review);\n    } catch (error) {\n      console.error('Failed to submit review:', error);\n    }\n\n    // Move to next item\n    moveToNextItem();\n  };\n\n  const moveToNextItem = () => {\n    const nextIndex = currentIndex + 1;\n    if (nextIndex < items.length) {\n      setCurrentIndex(nextIndex);\n      setCurrentItem(items[nextIndex]);\n      setIsFlipped(false);\n      setShowHint(false);\n      setReviewNotes('');\n      setStartTime(null);\n    } else {\n      // Session complete\n      setShowReviewDialog(true);\n    }\n  };\n\n  const handleSkip = () => {\n    if (currentItem) {\n      // Mark as skipped (quality 0 for flashcards, or just move on for other types)\n      if (currentItem.item_type === 'FLASHCARD') {\n        handleItemReview({ quality: 0, response_time_seconds: 0 });\n      } else {\n        moveToNextItem();\n      }\n    }\n  };\n\n  const handleReset = () => {\n    if (currentItem) {\n      // Reset item to new state\n      try {\n        AssessmentApi.resetAssessmentItem(currentItem.id);\n      } catch (error) {\n        console.error('Failed to reset item:', error);\n      }\n    }\n  };\n\n  if (!assessmentSet || !currentItem) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto\"></div>\n          <p className=\"mt-2 text-muted-foreground\">Loading assessment items...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Study Session</h2>\n          <p className=\"text-muted-foreground\">\n            {assessmentSet.title} • {items.length} items • {assessmentSet.kind}\n          </p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Button\n            variant={isPaused ? \"default\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => setIsPaused(!isPaused)}\n          >\n            {isPaused ? <Play className=\"h-4 w-4 mr-2\" /> : <Pause className=\"h-4 w-4 mr-2\" />}\n            {isPaused ? 'Resume' : 'Pause'}\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={handleReset}>\n            <RotateCw className=\"h-4 w-4 mr-2\" />\n            Reset Item\n          </Button>\n        </div>\n      </div>\n\n      {/* Progress Bar */}\n      <div className=\"space-y-2\">\n        <div className=\"flex justify-between text-sm\">\n          <span>Progress</span>\n          <span>{currentIndex + 1} of {items.length}</span>\n        </div>\n        <Progress value={((currentIndex + 1) / items.length) * 100} className=\"h-2\" />\n      </div>\n\n      {/* Session Stats */}\n      {session && (\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"text-2xl font-bold text-blue-600\">{session.itemsReviewed}</div>\n              <p className=\"text-xs text-muted-foreground\">Items Reviewed</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"text-2xl font-bold text-green-600\">{session.correctAnswers}</div>\n              <p className=\"text-xs text-muted-foreground\">Correct</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"text-2xl font-bold text-orange-600\">\n                {session.itemsReviewed > 0 ? Math.round((session.correctAnswers / session.itemsReviewed) * 100) : 0}%\n              </div>\n              <p className=\"text-xs text-muted-foreground\">Accuracy</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"text-2xl font-bold text-purple-600\">{session.currentStreak}</div>\n              <p className=\"text-xs text-muted-foreground\">Current Streak</p>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Current Item */}\n      <AssessmentItemRenderer\n        item={currentItem}\n        isFlipped={isFlipped}\n        showHint={showHint}\n        onFlip={() => setIsFlipped(!isFlipped)}\n        onToggleHint={() => setShowHint(!showHint)}\n        onReview={handleItemReview}\n        onReset={handleReset}\n        reviewNotes={reviewNotes}\n        onReviewNotesChange={setReviewNotes}\n        isPaused={isPaused}\n      />\n\n      {/* Navigation */}\n      <div className=\"flex justify-between items-center\">\n        <Button\n          variant=\"outline\"\n          onClick={handleSkip}\n          disabled={currentIndex >= items.length - 1}\n        >\n          <SkipForward className=\"h-4 w-4 mr-2\" />\n          Skip\n        </Button>\n        \n        <div className=\"text-sm text-muted-foreground\">\n          Item {currentIndex + 1} of {items.length}\n        </div>\n      </div>\n\n      {/* Session Complete Dialog */}\n      <Dialog open={showReviewDialog} onOpenChange={setShowReviewDialog}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Study Session Complete!</DialogTitle>\n            <DialogDescription>\n              Great job! Here's how you performed in this session.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {session && (\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"text-center\">\n                  <div className=\"text-2xl font-bold text-blue-600\">{session.itemsReviewed}</div>\n                  <p className=\"text-sm text-muted-foreground\">Items Reviewed</p>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-2xl font-bold text-green-600\">\n                    {session.itemsReviewed > 0 ? Math.round((session.correctAnswers / session.itemsReviewed) * 100) : 0}%\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">Accuracy</p>\n                </div>\n              </div>\n            )}\n            <div className=\"flex space-x-2\">\n              <Button variant=\"outline\" className=\"flex-1\" asChild>\n                <a href={`/active-project/${projectId}/flashcards`}>\n                  Back to Dashboard\n                </a>\n              </Button>\n              <Button className=\"flex-1\" onClick={() => window.location.reload()}>\n                Study Again\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\n"],"names":["AssessmentStudy","projectId","setId","assessmentSet","setAssessmentSet","useState","currentItem","setCurrentItem","items","setItems","currentIndex","setCurrentIndex","isFlipped","setIsFlipped","showHint","setShowHint","isLoading","setIsLoading","session","setSession","isPaused","setIsPaused","showReviewDialog","setShowReviewDialog","reviewNotes","setReviewNotes","responseTime","setResponseTime","startTime","setStartTime","useEffect","set","AssessmentApi","getAssessmentSet","getAssessmentItems","length","initializeSession","Date","newSession","id","now","toString","itemsReviewed","correctAnswers","totalTime","currentStreak","handleItemReview","review","endTime","timeSpent","getTime","updatedSession","is_correct","quality","reviewAssessmentItem","error","console","moveToNextItem","nextIndex","handleSkip","item_type","response_time_seconds","handleReset","resetAssessmentItem","div","className","p","h2","title","kind","Button","variant","size","onClick","Play","Pause","RotateCw","span","Progress","value","Card","CardContent","Math","round","AssessmentItemRenderer","item","onFlip","onToggleHint","onReview","onReset","onReviewNotesChange","disabled","SkipForward","Dialog","open","onOpenChange","DialogContent","DialogHeader","DialogTitle","DialogDescription","asChild","a","href","window","location","reload"],"mappings":"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"}